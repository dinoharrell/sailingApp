<!DOCTYPE html>
<html lang="en">
<head>
    </head>
<body class="p-4 flex flex-col items-center justify-center min-h-screen">
    <h1 class="text-xl font-bold mb-6 text-gray-400">SAILING SPEED MONITOR v2.4 (SOG)</h1>
    <script>
        // --- 1. CONFIGURATION (Unchanged) ---
        // ...
        
        // --- 2. DATA STRUCTURE & GLOBALS (Unchanged) ---
        // ...
        
        // --- 3. GEOMETRY FUNCTIONS (Unchanged) ---
        // ...
        
        // --- 4. PERSISTENCE, CORE LOGIC, CHART (Unchanged) ---
        // ...
        
        // --- 5. GEOLOCATION HANDLERS (Unchanged logic) ---
        function handlePosition(position) {
            const currentCoords = position.coords;
            const timestamp = position.timestamp;
            
            // --- DEBUG LINE: If this function runs, this message should update frequently. ---
            showStatus(`Fix received at: ${new Date(timestamp).toLocaleTimeString()}. Testing movement...`, false);
            // -------------------------------------------------------------------------------
            
            let speedInKnots = 0;
            // ... (rest of handlePosition remains the same) ...
        }
        
        function handleError(error) { /* ... (Same) ... */ }

        // --- 6. INITIALIZATION (Timeout Change is here) ---

        function startGpsWatch() {
            loadData();
            initChart(); 
            
            if (navigator.geolocation) {
                showStatus(speedBuffer.length > 0 ? "GPS Initializing. Displaying historical data..." : "Waiting for GPS fix...", false);
                
                watchId = navigator.geolocation.watchPosition(
                    handlePosition,
                    handleError,
                    {
                        // Increased timeout to 30 seconds to ensure successful initial lock
                        timeout: 30000,            
                        maximumAge: 0             
                    }
                );
            } else {
                handleError({ code: -1, message: "Geolocation is not supported by this browser." });
            }
        }

        document.addEventListener('DOMContentLoaded', startGpsWatch);
        
        window.onbeforeunload = function() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
            }
        };
    </script>
</body>
</html>
